<!DOCTYPE html>
<html>
<head>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>{{ recipe.title }}</title>
</head>
<body>
    <h2>{{ recipe.title }}</h2>
    <p><strong>By:</strong> {{ recipe.user.username }}</p>

    <p><strong>Ingredients:</strong><br>{{ recipe.ingredients.replace('\n', '<br>') | safe }}</p>
    <p><strong>Instructions:</strong><br>{{ recipe.instructions.replace('\n', '<br>') | safe }}</p>

    {% if current_user.is_authenticated %}
        {% if recipe.user_id != current_user.id %}
            <form method="POST" action="{{ url_for('rate_recipe', recipe_id=recipe.id) }}">
                <label for="score">Your Rating (1â€“5):</label>
                <input type="number" name="score" min="1" max="5" required>
                <button type="submit">Submit Rating</button>
            </form>
        {% else %}
            <p><em>You can't rate your own recipe.</em></p>
        {% endif %}

        {% if recipe in current_user.favorites %}
            <form method="POST" action="{{ url_for('unfavorite', recipe_id=recipe.id) }}">
                <button type="submit">Unfavorite</button>
            </form>
        {% else %}
            <form method="POST" action="{{ url_for('favorite', recipe_id=recipe.id) }}">
                <button type="submit">Favorite</button>
            </form>
        {% endif %}

        {% if recipe.user_id == current_user.id %}
            <form method="POST" action="{{ url_for('delete_recipe', recipe_id=recipe.id) }}">
                <button type="submit">Delete</button>
            </form>
            <form method="GET" action="{{ url_for('edit_recipe', recipe_id=recipe.id) }}">
                <button type="submit">Edit</button>
            </form>
        {% endif %}
    {% endif %}

    <p><strong>Average Rating:</strong>
        {{ recipe.average_rating if recipe.average_rating is not none else 'No ratings yet.' }}
    </p>
    <p><strong>Reviews:</strong> {{ recipe.ratings | length }}</p>

    <!-- Share section -->
    <p><strong>Share this recipe:</strong></p>

    <!-- WhatsApp Share -->
    <p>
        <a href="https://wa.me/?text={{ request.url }}" target="_blank">
            Share on WhatsApp
        </a>
    </p>

    <!-- Copy Link Button -->
    <p>
        <button onclick="copyLink()">Copy Recipe Link</button>
    </p>

    <script>
        function copyLink() {
            navigator.clipboard.writeText("{{ request.url }}")
                .then(() => alert("Link copied to clipboard!"))
                .catch(err => alert("Failed to copy link."));
        }
    </script>

    <br>
    <a href="{{ url_for('home') }}">Back to Dashboard</a>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
